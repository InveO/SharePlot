package jet.shareplot.ac.bo.merged.fullsharevalue;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import jet.container.managers.application.interfaces.ApplicationProxy;
import jet.container.managers.session.interfaces.Session;
import jet.framework.component.SimpleApplicationComponent;
import jet.framework.manager.datamodel.interfaces.ModelArray;
import jet.framework.nuts.select.FinderMethod;
import jet.framework.nuts.select.SelectNut;
import jet.framework.nuts.select.SelectNutHelper;
import jet.framework.ui.desktop.AbstractDesktopNut;
import jet.lifecycle.annotations.Deinitializer;
import jet.lifecycle.interfaces.LifeCycleState;
import jet.shareplot.ac.SelectStoreApplicationComponent;
import jet.shareplot.persistence.finder.fullsharevalue.FullShareValue_FindAll0;
import jet.util.SerializableKey;
import jet.util.logger.JETLevel;
import jet.util.models.interfaces.Model;
import jet.util.throwable.JETException;

/**
 * FullShareValue manipulation API
 *
 * Generated by JetTools, you can edit this file directly, Once created it will not be overwritten
 *
 * @author JetToolsFramework
 */
public class FullShareValueApplicationComponent extends SimpleApplicationComponent {

    private static final long serialVersionUID = 1L;
    /**
     * <code>NAME</code> of this application component, so it can be retrieved easily.
     */
    private final static String NAME = "FullShareValueApplicationComponent";
    /**
     * <code>SESSION_KEY</code> session key
     */
    private final static Object SESSION_KEY = new SerializableKey(FullShareValueApplicationComponent.class, "SESSION_KEY");

    /**
     * Get the instance of the FullShareValueApplicationComponent linked to the session. If there
     * is not already one it will be created.
     *
     * @param session current session
     * @return FullShareValueApplicationComponent
     * @throws JETException
     */
    public static final FullShareValueApplicationComponent getInstance(final Session session) throws JETException {
        FullShareValueApplicationComponent fullShareValueAC = (FullShareValueApplicationComponent) session.getProperty(SESSION_KEY);

        if (fullShareValueAC != null) {
            final LifeCycleState lcs = fullShareValueAC.getInitializableSupport().getLifeCycleState();
            if (lcs == LifeCycleState.UNINITIALIZED) {
                session.removeProperty(SESSION_KEY);
                fullShareValueAC = null;
            }
        }

        if (fullShareValueAC == null) {
            final AbstractDesktopNut desktopNut = (AbstractDesktopNut) session.getProperty(AbstractDesktopNut.SESSION_KEY_DESKTOP);
            if (desktopNut == null) {
                throw new JETException("Can only be used with an AbstractDesktopNut for the desktop.");
            }

            final ApplicationProxy appProxy = desktopNut.getApplicationProxy();
            if (appProxy.hasApplicationComponent(NAME)) {
                try {
                    final Map<String, Object> initMap = new HashMap<String, Object>();
                    fullShareValueAC = (FullShareValueApplicationComponent) appProxy.createApplicationComponent(NAME, desktopNut.getApplicationComponent(), initMap);
                    desktopNut.registerChildApplicationComponent(fullShareValueAC);
                    session.setProperty(SESSION_KEY, fullShareValueAC);
                } catch (final JETException e) {
                    desktopNut.logp(JETLevel.SEVERE, NAME, "getInstance", e.getMessage(), e);
                    throw new JETException("Could not instantiate the FullShareValueApplicationComponent.", e);
                }
            } else {
                desktopNut.logp(JETLevel.INFO, NAME, "getInstance", "NO APPLICATION COMPONENT FOUND FOR : " + NAME);
                throw new JETException("NO APPLICATION COMPONENT FOUND FOR : " + NAME);
            }
        }

        return fullShareValueAC;
    }

    /**
     * Deinit, internal use only
     *
     * @throws JETException
     */
    @Deinitializer
    public final void doAccountACDeinit() throws JETException {
        getSession().removeProperty(SESSION_KEY);
    }

    /**
     * Return all fullShareValue matching the FinderMethod.
     *
     * @param finder FinderMethod to use to fetch the FullShareValues
     * @return a list of fullShareValue matching the FinderMethod.
     * @see List
     * @see FullShareValue
     */
    protected List<FullShareValue> getFullShareValues(final FinderMethod finder) {
        final List<FullShareValue> result = new ArrayList<FullShareValue>();

        final SelectNut selectNut = getSelectNut(SelectStoreApplicationComponent.FULLSHAREVALUE_SELECT);
        final ModelArray ma = SelectNutHelper.getModelArray(selectNut, finder, getLogger());
        if (ma != null) {
            final int size = ma.getSize();
            for (int i = 0; i < size; i++) {
                final Model model = ma.get(i);
                final FullShareValue fullShareValue = new FullShareValue(model, this);
                result.add(fullShareValue);
            }
        }

        return result;
    }

    /**
     * Return the first fullShareValue matching the FinderMethod.
     *
     * @param finder FinderMethod to use to fetch the FullShareValue
     * @return the fullShareValue matching the FinderMethod.
     * @see FullShareValue
     */
    protected FullShareValue getFullShareValue(final FinderMethod finder) {
        final FullShareValue result;

        final SelectNut selectNut = getSelectNut(SelectStoreApplicationComponent.FULLSHAREVALUE_SELECT);
        final Model model = SelectNutHelper.getModel(selectNut, finder, getLogger());
        if (model != null) {
            result = new FullShareValue(model, this);
        } else {
            result = null;
        }

        return result;
    }

    /**
     * Sample method making a call to getFullShareValues(final FinderMethod finder).
     *
     * @return a list of fullShareValue matching the FinderMethod.
     * @see List
     * @see FullShareValue
     * @see #getFullShareValues(FinderMethod finder)
     */
    public List<FullShareValue> getFullShareValues() {
        final FullShareValue_FindAll0 finder = new FullShareValue_FindAll0();

        return getFullShareValues(finder);
    }

}
